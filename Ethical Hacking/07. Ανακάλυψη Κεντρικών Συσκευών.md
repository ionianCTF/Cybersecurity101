# Nmap για Pentester: Ανίχνευση Συστημάτων (Host Discovery)
---

Το Nmap έχει γίνει ένα από τα πιο δημοφιλή εργαλεία σάρωσης δικτύου, αφήνοντας πίσω άλλους σαρωτές. Πολλές φορές, οι διαχειριστές δικτύου ασφαλίζουν κεντρικούς υπολογιστές σε οργανισμούς με firewalls ή συστήματα πρόληψης εισβολών. Ωστόσο, αυτά τα μέτρα μπορεί να μπλοκάρουν προσπάθειες σάρωσης λόγω των κανόνων φιλτραρίσματος κυκλοφορίας. Στο Nmap, ένας pentester μπορεί εύκολα να χρησιμοποιήσει εναλλακτικές τεχνικές ανίχνευσης οικοδεσποτών ώστε να αποτρέψει αυτό. Περιλαμβάνει λειτουργίες που κάνουν την κυκλοφορία δικτύου λιγότερο ύποπτη. Ας δούμε διάφορες τεχνικές Host Discovery.

---

## Πίνακας Περιεχομένων

- Ping Sweep (Χωρίς port scan)
- Disable-arp-ping
- Send-ip
- TCP Flags
- Τύποι Σαρώσεων
- TCP SYN Ping Scan
- TCP ACK Ping Scan
- ICMP ECHO Ping Scan
- ICMP ECHO Ping Sweep
- UDP Ping Scan
- IP Protocol Ping Scan
- ARP Ping Scan
- Traceroute

---

## Ping Sweep

Ας ξεκινήσουμε με σάρωση ολόκληρου του δικτύου χρησιμοποιώντας το Ping sweep (`-sP`).

```bash
nmap -sP 192.168.1.0/24
```

![screenshot](https://1.bp.blogspot.com/-zBU41BQQ9RM/X9oCvsp-WlI/AAAAAAAAruU/w5XEzEXTwLcn0lx28ML9wADhCvulNIqZwCLcBGAsYHQ/s16000/1.png)

Παρατηρώντας τα πακέτα στο Wireshark, θα διαπιστώσετε ότι οι σαρώσεις δικτύου στέλνουν μόνο ARP πακέτα.

![screenshot](https://1.bp.blogspot.com/-_YkHX8UW9vQ/X9oC1Ip9yHI/AAAAAAAAruY/8pSEUxNfUr0NDFArcXWreLvuYXyre_BmwCLcBGAsYHQ/s16000/2.png)

**Σημείωση:** Η λειτουργία `-sP` και `-sn` είναι ίδια.

Ας δοκιμάσουμε το ίδιο χρησιμοποιώντας την επιλογή **no port scanning (`-sn`)**. Σε αυτήν την επιλογή, χρησιμοποιούμε επίσης `--packet-trace` για λεπτομερή παρουσίαση πακέτων (χωρίς Wireshark). Εδώ θα παρατηρήσετε τα ARP πακέτα.

```bash
nmap -sn 192.168.1.0/24 --packet-trace
```

![screenshot](https://1.bp.blogspot.com/-8WnmNc4w5v8/X9oC-zu49NI/AAAAAAAAruc/9p7-WA0rergAPasKrO4afk-5rjPSDjDhQCLcBGAsYHQ/s16000/4.png)

Τώρα που αναγνωρίσαμε ARP πακέτα στο δίκτυο, μπορούμε να χρησιμοποιήσουμε την επιλογή `--disable-arp-ping`. Σε αυτή την περίπτωση θα δείτε ότι αποστέλλονται τέσσερα πακέτα αντί για ARP.

---

## Disable-arp-ping

Για να απενεργοποιήσετε την ανακάλυψη μέσω ARP, το Nmap παρέχει αυτήν την επιλογή.

```bash
nmap -sn 192.168.1.108 --disable-arp-ping
```

![screenshot](https://1.bp.blogspot.com/-26JjyN6O-Qw/X9oD96CUAAI/AAAAAAAArvY/UQhmiaq78z8lbjDwvDxgwyhOeRWOiPW0QCLcBGAsYHQ/s16000/7.png)

Και θα δείτε ότι τα ARP πακέτα δεν είναι ορατά.

**Σημείωση:** Όταν σαρώσετε το τοπικό δίκτυο με Nmap, το Nmap στέλνει ένα ARP πακέτο με κάθε σάρωση. Αν σαρώσετε εξωτερικό δίκτυο και χρησιμοποιήσετε `--disable-arp-ping`, το Nmap στέλνει τα ακόλουθα αιτήματα πακέτων:

![screenshot](https://1.bp.blogspot.com/-1diCaqoafrU/X9oDG0C0p1I/AAAAAAAArus/u8gzMLfz0mk5K8Un-H5uAZ20MES1rMGtgCLcBGAsYHQ/s16000/3.png)

![screenshot](https://1.bp.blogspot.com/-SL5NkbmaKv0/X9oD1ssN3vI/AAAAAAAArvU/1A1xdvnzT60HJXSq27Vbr6AKqXLslx_wwCLcBGAsYHQ/s16000/8.png)

Μπορείτε επίσης να χρησιμοποιήσετε την επιλογή `--send-ip` για να έχετε τα ίδια αποτελέσματα όπως παραπάνω.

---

## send-ip

```bash
nmap -sn 192.168.1.108 --packet-trace --send-ip
```

![screenshot](https://1.bp.blogspot.com/-ZYJthAyKmhI/X9oDdYvxXbI/AAAAAAAArvI/Ah45BLJJauMRIOxkX7sddDdYOdn1qwFBwCLcBGAsYHQ/s16000/6.png)

Η ανίχνευση οικοδεσποτών (Host Discovery) είναι το πιο θεμελιώδες βήμα στη συλλογή πληροφοριών. Παρέχει ακριβή αποτελέσματα σχετικά με ανοιχτές θύρες και διευθύνσεις IP στο δίκτυο.

---

## TCP Flags

Αρχικά, ας γνωρίσουμε τα βασικά για τα flags επικοινωνίας στο TCP. Η κεφαλίδα TCP αποτελείται κυρίως από έξι flags που διαχειρίζονται τη σύνδεση μεταξύ συστημάτων και παρέχουν εντολές. Κάθε flag είναι 1 bit και επομένως το μέγεθος των TCP Flags είναι 6 bits.

![tcp flags](https://1.bp.blogspot.com/-H2WZzYyaXuA/X9nsbBuLSfI/AAAAAAAArqs/qV4_YIIs2vA_iDSISF_GYydRlHJOsr7HACLcBGAsYHQ/s16000/0.png)

---

## Τύποι Σαρώσεων

Για να ανακαλύψετε οικοδεσπότες στο δίκτυο, μπορούν να χρησιμοποιηθούν διάφορες μέθοδοι ping scan.

![types of scans](https://1.bp.blogspot.com/-OksplVkgMOM/X9nshJuAm1I/AAAAAAAArqw/1mUcYOg7Hqss5hEb1UDJAxYNF3IBSrZqwCLcBGAsYHQ/s16000/1.5.png)

---

## TCP SYN Ping Scan

Είναι μια μέθοδος ανίχνευσης που βοηθά να ανακαλύψετε αν οι θύρες είναι ανοιχτές και αν συμφωνούν με τους κανόνες του firewall. Ο pentester μπορεί να στείλει ένα πακέτο με σημαία SYN στον στόχο για να ελέγξει αν είναι ζωντανός. Μπορούν να οριστούν πολλαπλές θύρες.

![syn](https://1.bp.blogspot.com/-FnQnSl2GmpY/X9nsmHFQS5I/AAAAAAAArq0/sUf4xyAJquon6pZfCjZRKqAOCPQ2IPYXQCLcBGAsYHQ/s16000/49.png)

Η εντολή `-sP` στο Nmap προορίζεται για ανακάλυψη online οικοδεσποτών. Από την άλλη, το SYN Ping (`-PS`) στέλνει TCP SYN σε συγκεκριμένες θύρες. Αν μια θύρα είναι κλειστή, ο οικοδεσπότης απαντά με RST. Αν είναι ανοιχτή, απαντά με SYN/ACK και ακολουθεί reset για τερματισμό.

```bash
nmap -sn -PS 192.168.1.108 --disable-arp-ping
```

![syn packet capture](https://1.bp.blogspot.com/-dySshbLmXhs/X9nsrxsKfDI/AAAAAAAArq8/Cc_ZHJmraD05A69FHh7LZEcRG0Js2SPhwCLcBGAsYHQ/s16000/50.png)

Τα πακέτα που καταγράφονται με Wireshark μπορούν να παρατηρηθούν:

![wireshark capture](https://1.bp.blogspot.com/-8q0eB-81Zk4/X9nsxcHL06I/AAAAAAAArrE/w0r_CwwtSZ8uW5AHdT4GukEoyNInkXZGwCLcBGAsYHQ/s16000/51.png)

Το πλεονέκτημα του TCP SYN Ping είναι ότι ο pentester μπορεί να μάθει την κατάσταση του οικοδεσπότη χωρίς να δημιουργήσει πλήρη σύνδεση, μειώνοντας εγγραφές (logs).

---

## TCP ACK Ping Scan

Παρόμοιο με SYN Ping, αλλά διαφέρει ελαφρώς. Στέλνει ένα TCP πακέτο χωρίς περιεχόμενο στον στόχο (π.χ. port 80). Καθώς δεν υπάρχει σύνδεση, μπορεί να λάβει πακέτο Acknowledgement και μετά reset.

![ack](https://1.bp.blogspot.com/-c2UtiL319xM/X9ns2rxiNKI/AAAAAAAArrM/TA_IZSm-lQIoy0JxCrzUHG_6VFiv-CyGACLcBGAsYHQ/s16000/52.0.png)

Αυτό βοηθά να καθοριστεί πώς ανταποκρίνεται ο στόχος, και ελέγχει αν firewalls μπλοκάρουν SYN ή ICMP.

```bash
nmap -sn -PA 192.168.1.108 --disable-arp-ping
```

![ack wireshark](https://1.bp.blogspot.com/-yIGwH6uaDio/X9ns8LTTBTI/AAAAAAAArrU/axj29DTlytQr37eR6d77o5rUucR6oRrXwCLcBGAsYHQ/s16000/52.png)

Τα καταγεγραμμένα πακέτα στο Wireshark:

![wireshark ack](https://1.bp.blogspot.com/-QHmP7o6uA_c/X9ntA2iM-zI/AAAAAAAArrc/nuoL27my5ukOjWuLf_LCpOj34NfAfM0hACLcBGAsYHQ/s16000/53.png)

Αυτή η σάρωση μπορεί να παρακάμψει firewall που μπλοκάρει SYN ping πακέτα.

---

## ICMP Echo Ping Scan

Η ICMP Ping σάρωση συλλέγει πληροφορίες για τα συστήματα στόχους, στέλνοντας ICMP ECHO request και περιμένοντας ICMP ECHO reply.

```bash
nmap -sn -PE 192.168.1.108 --disable-arp-ping
```

![icmp echo](https://1.bp.blogspot.com/-KDy8RqYsB7o/X9ntIhZnz_I/AAAAAAAArrk/OGfdR20Uo-QF5hoiKK8n7mUQzZgnRigMACLcBGAsYHQ/s16000/54.0.png)

Καταγραφές Wireshark:

![icmp wireshark](https://1.bp.blogspot.com/-2727K8DbHdo/X9ntOJzJu3I/AAAAAAAArrs/-7g4NnLOFpMsVkNsmdSLo2NDO_fFymkGACLcBGAsYHQ/s16000/54.png)

![icmp capture](https://1.bp.blogspot.com/-Rsa5Aa0jaOo/X9ntVK0brmI/AAAAAAAArr0/_PWqvzjFWBkD5WfLxSH3g1fOQLdC3tyJgCLcBGAsYHQ/s16000/55.png)

---

## ICMP ECHO Ping Sweep

Μοιάζει με Echo Ping Scan αλλά σαρώνει πολλούς στόχους σε εύρος διευθύνσεων — στέλνει ICMP requests σε μεγάλο αριθμό στόχων και περιμένει replies.

```bash
nmap -sn -PE 192.168.1-10
```

![icmp sweep result](https://1.bp.blogspot.com/-axDIRUtlGC8/X9ntcbRJdGI/AAAAAAAArr8/XWq44rVyEBYhn-MnmBh5aFGeft0x9_tEQCLcBGAsYHQ/s16000/56.0.png)

---

## ICMP Address Mask Scan

Παλιότερη μέθοδος ICMP που αποκαλύπτει πληροφορία για το σύστημα και το subnet mask.

```bash
nmap -sn -PM 192.168.1.108 --disable-arp-ping
```

![icmp mask](https://1.bp.blogspot.com/-xojve1REjzc/X9ntsSjGA2I/AAAAAAAArsI/sjtTNkj_iiAuqAWz-aDCR8baqE7SkFpEwCLcBGAsYHQ/s16000/56.5.png)

---

## ICMP ECHO Timestamp Scan

Χρησιμοποιείται όταν ο διαχειριστής μπλοκάρει κανονικά ICMP timestamp. Χρησιμεύει για συγχρονισμό χρόνου.

```bash
nmap -sn -PP 192.168.1.108 --disable-arp-ping
```

![icmp timestamp](https://1.bp.blogspot.com/-XKSXCeaDF6M/X9nt2EphOUI/AAAAAAAArsM/Xa5xuzY0HjwpGAfalDf_OJmDXEAxH7KHQCLcBGAsYHQ/s16000/56.png)

Καταγραφές Wireshark:

![icmp timestamp capture](https://1.bp.blogspot.com/-xvdqF8KMpns/X9nt8lqxTVI/AAAAAAAArsU/R4EPp2-GuY4zpNzoB-IHoB3T50z_zq0GgCLcBGAsYHQ/s16000/57.png)

---

## UDP Ping Scan

Το UDP Ping χρησιμοποιεί προεπιλεγμένη (συνήθως ασυνήθιστη) θύρα 40125 για αποστολή πακέτων στον στόχο. Παρόμοιο με TCP Ping: αν υπάρξει απάντηση, ο οικοδεσπότης είναι ενεργός.

```bash
nmap -sn -PU 192.168.1.108 --disable-arp-ping
```

![udp ping](https://1.bp.blogspot.com/-HFhuNk7UD0E/X9nuDftu90I/AAAAAAAArsY/3fD1X_tUORwLIFEvmU07O7YDJpMkFRIswCLcBGAsYHQ/s16000/60..png)

Το πλεονέκτημα του UDP είναι ότι μπορεί να εντοπίσει συστήματα με αυστηρούς TCP κανόνες firewall ενώ οι κανόνες UDP είναι πιο χαλαροί.

Καταγραφές Wireshark:

![udp wireshark](https://1.bp.blogspot.com/-sTNvWBis6t0/X9nuJMFh7bI/AAAAAAAArsc/XGMgArheCtAaKpFX8oDbw7Res4y3_ngBQCLcBGAsYHQ/s16000/60.png)

![udp capture](https://1.bp.blogspot.com/-_X8jCjSo1gY/X9nuPoZ0v-I/AAAAAAAArsk/yNcFYTDUDWsKX2UYQ1o0Tz5qMKC-VnvUACLcBGAsYHQ/s16000/61.png)

---

## IP Protocol Ping Scan

Ο pentester στέλνει πακέτα με διάφορα πρωτόκολλα IP και ελπίζει να λάβει απάντηση εάν ο στόχος είναι ενεργός.

```bash
nmap -sn -PO 192.168.1.108 --disable-arp-ping
```

![ip protocol ping](https://1.bp.blogspot.com/-gWYgNzIXw30/X9nuWBVnL6I/AAAAAAAArss/GDxk-TUwuTMzyJdSwvN9HPQnpyFo7_q8ACLcBGAsYHQ/s16000/62.0.png)

Καταγραφές Wireshark:

![ip proto capture](https://1.bp.blogspot.com/-66rqGiSHggM/X9nuc4fEaRI/AAAAAAAArs0/78XVxy9uIdAyqqblCLd7TJm_8aQesms9QCLcBGAsYHQ/s16000/62.png)

![ip proto packet](https://1.bp.blogspot.com/-pEKt3ELps2g/X9nuiwWL30I/AAAAAAAArs8/HBa9u-VeZqg6MAk2rW2n7i4v7AgWO8ZAwCLcBGAsYHQ/s16000/63.png)

---

## No ping scan

Σε αυτή τη μέθοδο, η ανίχνευση οικοδεσποτών παραλείπεται πλήρως. Ο pentester το χρησιμοποιεί για να εντοπίσει ενεργές μηχανές πριν από βαριές σαρώσεις ή για αύξηση ταχύτητας.

```bash
nmap -sn -PN 192.168.1.108 --disable-arp-ping
```

![no ping](https://1.bp.blogspot.com/-cIjSTaRAkmI/X9nu1eSQzqI/AAAAAAAArtQ/Ex6NTjxvOq8YXUq7kIwesuMVb4xc7-R9QCLcBGAsYHQ/s16000/64.png)

---

## ARP ping scan

Σε αυτή τη μέθοδο στέλνονται ARP πακέτα σε όλες τις συσκευές του δικτύου — ακόμα κι αν είναι "αόρατες" λόγω firewall. Οι ARP ping σαρώσεις θεωρούνται συνήθως πιο αποδοτικές από άλλες μεθόδους Host Discovery και παρέχουν επίσης πληροφορίες λανθάνουσας κατάστασης (latency).

```bash
nmap -sn -PR 192.168.1.108
```

![arp ping](https://1.bp.blogspot.com/-D6ImR3dAIP0/X9nu7RaM8cI/AAAAAAAArtU/hSJfqoEiyQMJFdcf8O7UmefNdi3UsU8UQCLcBGAsYHQ/s16000/65.0.png)

Καταγραφές Wireshark:

![arp wireshark 1](https://1.bp.blogspot.com/-hKeR9-4RWrU/X9nvBoovxUI/AAAAAAAArtc/Zfa7ZwVwDDYcC9ITEcNKp-Js5SNVkVXzQCLcBGAsYHQ/s16000/65.png)

![arp wireshark 2](https://1.bp.blogspot.com/-x-Pc5lXTWqM/X9nvHeVyHtI/AAAAAAAArtk/X_K8M4ICIygFD8PUmkN6K_4NGCqTJCcjwCLcBGAsYHQ/s16000/66.png)

---

## SCTP INIT Ping

Στέλνει SCTP πακέτο περιέχοντας ένα ελάχιστο INIT chunk. Η προεπιλεγμένη θύρα προορισμού είναι 80. Το INIT chunk προτείνει στο απομακρυσμένο σύστημα πως ο pentester προσπαθεί να δημιουργήσει σύνδεση/assocation.

```bash
nmap -sn -PY 192.168.1.108 --disable-arp-ping
```

![sctp init](https://1.bp.blogspot.com/-V45WvC3lB7I/X9nvMVLBTMI/AAAAAAAArts/Rq55K61lA7EJfd49Idzrj5F-r2P_earZgCLcBGAsYHQ/s16000/67.png)

Καταγραφές:

![sctp capture](https://1.bp.blogspot.com/-e6FubgSW27o/X9nvST5xs3I/AAAAAAAArt0/1yNxa27RoVsr_8bD-I1-LkUKtNqaW5OQQCLcBGAsYHQ/s16000/68.png)

---

## Traceroute

Οι χρήστες συνήθως εκτελούν traceroute μετά το τέλος μιας σάρωσης. Σε αυτό το στάδιο, μπορείτε να χρησιμοποιήσετε τις πληροφορίες από τα αποτελέσματα της σάρωσης για να καθορίσετε θύρα και πρωτόκολλο που θα φτάσει στον στόχο.

```bash
nmap -sn --traceroute 8.8.8.8
```

![traceroute](https://1.bp.blogspot.com/-UQ3ikP5JpBs/X9nvY1o5gSI/AAAAAAAArt4/avxGahQXY0sT15BfxQC72PUBomNNl_L2ACLcBGAsYHQ/s16000/69.png)
