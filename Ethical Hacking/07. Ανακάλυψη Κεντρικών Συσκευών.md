
# Nmap για Pentester: Ανακάλυψη Κεντρικών Συσκευών (Host Discovery)

---

## Εισαγωγή

Το Nmap έχει γίνει ένα από τα πιο δημοφιλή εργαλεία για σάρωση δικτύου, ξεπερνώντας άλλους σαρωτές. Συχνά οι διαχειριστές δικτύων προστατεύουν hosts με firewalls ή συστήματα πρόληψης εισβολών, τα οποία μπορεί να μπλοκάρουν προσπάθειες σάρωσης. Ωστόσο, το Nmap προσφέρει εναλλακτικές τεχνικές *Host Discovery* που μπορούν να κάνουν την κίνηση λιγότερο ύποπτη. Ακολουθεί παρουσίαση διαφόρων τεχνικών ανίχνευσης hosts.

---

## Πίνακας Περιεχομένων

- Ping Sweep (χωρίς σάρωση θυρών)
- `--disable-arp-ping`
- `--send-ip`
- Σημαίες TCP (TCP Flags)
- Τύποι Σαρώσεων
- TCP SYN Ping Scan
- TCP ACK Ping Scan
- ICMP ECHO Ping Scan
- ICMP ECHO Ping Sweep
- UDP Ping Scan
- IP Protocol Ping Scan
- ARP Ping Scan
- Traceroute

---

## Ping Sweep

Αρχίζουμε με σάρωση ολόκληρου του δικτύου χρησιμοποιώντας την επιλογή Ping sweep (`-sP`):

```bash
nmap -sP 192.168.1.0/24
```

> Παρατήρηση: Όταν παρακολουθείτε τα πακέτα με Wireshark, θα δείτε ότι οι σαρώσεις στο ίδιο υποδίκτυο στέλνουν μόνο ARP πακέτα.

Η λειτουργία `-sP` και `-sn` είναι ίδια.

Παράδειγμα χωρίς σάρωση θυρών (`-sn`) και με `--packet-trace` για να δείτε λεπτομερή πληροφορία πακέτων:

```bash
nmap -sn 192.168.1.0/24 --packet-trace
```

---

## `--disable-arp-ping`

Για να απενεργοποιήσετε την ανίχνευση ARP, χρησιμοποιήστε αυτήν την επιλογή:

```bash
nmap -sn 192.168.1.108 --disable-arp-ping
```

Σε τοπικό δίκτυο, το Nmap στέλνει ARP packet για κάθε σάρωση εκ προεπιλογής. Όταν σαρώνετε εξωτερικά δίκτυα, η χρήση του `--disable-arp-ping` προκαλεί αποστολή άλλων τύπων πακέτων (βλέπε παρακάτω `--send-ip`).

---

## `--send-ip`

Μπορείτε επίσης να χρησιμοποιήσετε `--send-ip` για παρόμοια συμπεριφορά:

```bash
nmap -sn 192.168.1.108 --packet-trace --send-ip
```

---

## Σημαίες TCP (TCP Flags)

Η TCP κεφαλίδα περιλαμβάνει διάφορες σημαίες που χειρίζονται τη σύνδεση (SYN, ACK, RST, FIN, URG, PSH κ.λπ.). Η σωστή χρήση σημαδιών επιτρέπει τεχνικές ανίχνευσης που μοιάζουν λιγότερο με κανονική σύνδεση.

(Στο αρχικό άρθρο υπάρχει εικόνα με τις σημαίες TCP.)

---

## Τύποι Σαρώσεων (Host Discovery Methods)

Το άρθρο παρουσιάζει πολλούς τρόπους ανίχνευσης hosts:

- TCP SYN Ping Scan
- TCP ACK Ping Scan
- ICMP Echo Ping Scan
- ICMP Echo Ping Sweep
- ICMP Address Mask Scan
- ICMP ECHO Timestamp Scan
- UDP Ping Scan
- IP Protocol Ping Scan
- No ping scan (παράκαμψη host discovery)
- ARP ping scan
- SCTP INIT Ping
- Traceroute

---

### TCP SYN Ping Scan

Αποστέλλει TCP πακέτο με σημαία SYN σε επιλεγμένες θύρες για να ελέγξει αν ο στόχος είναι ζωντανός:

```bash
nmap -sn -PS 192.168.1.108 --disable-arp-ping
```

Αν η πόρτα είναι κλειστή, ο στόχος θα απαντήσει με RST. Αν είναι ανοιχτή, θα απαντήσει με SYN/ACK — το Nmap τότε στέλνει reset για να τερματίσει τον ημι-ανοιχτό σύνδεσμο.

Πλεονέκτημα: ανακτά το status του host χωρίς πλήρη σύνδεση (stealthy).

---

### TCP ACK Ping Scan

Στέλνει TCP πακέτο χωρίς σύνδεση (ACK) — βοηθά να διαπιστωθεί πώς απαντά ο στόχος και αν κάποιο firewall μπλοκάρει SYN/ICMP:

```bash
nmap -sn -PA 192.168.1.108 --disable-arp-ping
```

---

### ICMP Echo Ping Scan

Στέλνει ICMP ECHO request και περιμένει ECHO reply:

```bash
nmap -sn -PE 192.168.1.108 --disable-arp-ping
```

---

### ICMP ECHO Ping Sweep

Σαρώνει εύρος διευθύνσεων προς αναζήτηση ενεργών hosts:

```bash
nmap -sn -PE 192.168.1-10
```

---

### ICMP Address Mask Scan

Παλιότερη μέθοδος που επιστρέφει πληροφορία για το σύστημα και τη μάσκα υποδικτύου:

```bash
nmap -sn -PM 192.168.1.108 --disable-arp-ping
```

---

### ICMP ECHO Timestamp Scan

Χρήσιμο όταν το συνηθισμένο ICMP μπλοκάρεται — επιστρέφει πληροφορίες συγχρονισμού χρόνου:

```bash
nmap -sn -PP 192.168.1.108 --disable-arp-ping
```

---

### UDP Ping Scan

Χρησιμοποιεί UDP πακέτο (συνήθως στο port 40125) για να δει αν υπάρχει απάντηση — χρήσιμο όταν TCP κανόνες firewall είναι αυστηροί αλλά UDP είναι πιο ελεύθερο:

```bash
nmap -sn -PU 192.168.1.108 --disable-arp-ping
```

---

### IP Protocol Ping Scan

Στέλνει πακέτα με διάφορα IP πρωτόκολλα και περιμένει απάντηση:

```bash
nmap -sn -PO 192.168.1.108 --disable-arp-ping
```

---

### No ping scan (αποφυγή host discovery)

Παρακάμπτει το host discovery — χρήσιμο όταν θέλετε να σαρώσετε χωρίς πρώτα να κάνετε ping:

```bash
nmap -sn -PN 192.168.1.108 --disable-arp-ping
```

---

### ARP Ping Scan

Στέλνει ARP πακέτα στο τοπικό δίκτυο — συνήθως πιο αποτελεσματικό σε LAN:

```bash
nmap -sn -PR 192.168.1.108
```

---

### SCTP INIT Ping

Στέλνει ελάχιστο SCTP INIT chunk (προεπιλεγμένη θύρα 80) για να δοκιμάσει αν ο στόχος ανταποκρίνεται:

```bash
nmap -sn -PY 192.168.1.108 --disable-arp-ping
```

---

## Traceroute

Συνήθως εκτελείται μετά από μια σάρωση για να προσδιοριστεί το μονοπάτι προς τον στόχο. Μπορείτε να χρησιμοποιήσετε την επιλογή `--traceroute`:

```bash
nmap -sn --traceroute 8.8.8.8
```

---

